generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Property {
  id            String   @id @default(uuid())
  title         String
  slug          String   @unique
  address       String
  city          String
  state         String
  zip           String
  description   String
  squareFeet    Int      @map("square_feet")
  clearHeight   String?  @map("clear_height")
  dockDoors     Int      @default(0) @map("dock_doors")
  driveInDoors  Int      @default(0) @map("drive_in_doors")
  acreage       Float?
  leaseOrSale   String   @default("Lease") @map("lease_or_sale")
  priceOrRate   String?  @map("price_or_rate")
  availableDate DateTime? @map("available_date")
  highlights    Json     @default("[]")
  status        String   @default("Available")
  featured      Boolean  @default(false)
  archived      Boolean  @default(false)
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  images PropertyImage[]
  leads  Lead[]

  @@index([status])
  @@index([city])
  @@index([featured])
  @@index([archived])
  @@map("wd_property")
}

model PropertyImage {
  id         String   @id @default(uuid())
  propertyId String   @map("property_id")
  url        String
  alt        String?
  sortOrder  Int      @default(0) @map("sort_order")
  createdAt  DateTime @default(now()) @map("created_at")

  property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@index([sortOrder])
  @@map("wd_property_image")
}

model Lead {
  id                String   @id @default(uuid())
  propertyId        String?  @map("property_id")
  type              String   @default("Contact")
  name              String
  email             String
  phone             String?
  company           String?
  message           String
  preferredDateTime String?  @map("preferred_date_time")
  status            String   @default("New")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  property Property? @relation(fields: [propertyId], references: [id], onDelete: SetNull)

  @@index([propertyId])
  @@index([type])
  @@index([status])
  @@index([createdAt])
  @@map("wd_lead")
}

model Admin {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String   @map("password_hash")
  name         String?
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("wd_admin")
}

model Session {
  id        String   @id @default(uuid())
  adminId   String   @map("admin_id")
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")

  @@index([adminId])
  @@index([expiresAt])
  @@map("wd_session")
}

model RateLimit {
  id        String   @id
  count     Int      @default(1)
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")

  @@index([expiresAt])
  @@map("wd_rate_limit")
}
